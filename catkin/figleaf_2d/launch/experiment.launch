<launch>
  <arg name="user" /> <!-- User name or ID -->
  <!-- Type of filter to use. "filter" is used for naming the rosbag. "clean",
       "box", etc. turn the appropriate features on or off. -->
  <arg name="filter" />
  <arg name="clean" default="False" />
  <arg name="blur" default="False" />
  <arg name="mid" default="False" />
  <arg name="box" default="False" />
  <arg name="data_dir" /> <!-- Where to save rosbag data. -->

  <!-- Blur condition: Node that blurs the Kinect image. -->
  <node
    if="$(arg blur)"
    pkg="figleaf_2d"
    type="blur"
    name="kinect_blurrer"
    args="/head_mount_kinect/rgb/image_color /blurred_kinect_rgb" />

  <!-- Mid condition.
       1) Node that calls object segmentation repeatedly.
       2) Node that displays segmented objects as a point cloud. -->
  <node
    if="$(arg mid)"
    pkg="rviz_objdetect_caller"
    type="objdetect_caller_node"
    name="objdetect_caller_node" />
  <node
    if="$(arg mid)"
    pkg="rviz_objdetect_caller"
    type="publish_points_node"
    name="publish_points_node" />

  <!-- Box condition.
       1) Node that calls object segmentation repeatedly.
       2) Node that displays segmented objects as boxes. -->
  <node
    if="$(arg box)"
    pkg="rviz_objdetect_caller"
    type="objdetect_caller_node"
    name="objdetect_caller_node" />
  <node
    if="$(arg box)"
    pkg="rviz_objdetect_caller"
    type="publish_boxes_node"
    name="publish_boxes_node" />

  <!-- rosbag recording node. -j option is for compression. -->
  <node
    pkg="rosbag"
    type="record"
    name="rosbag_record_exp"
    args="
      record -j -O $(arg data_dir)/$(arg user)_$(arg filter).bag
      pr2_marker_control_transparent/feedback
      rviz_camera_publisher/camera_pose
      head_mount_kinect/rgb/image_rect_color
      head_mount_kinect/depth_registered/image_rect" />

  <!-- Launches pr2_interactive_manipulation frontend with one of the
       figleaf_2d config files: {clean, blur, box}.rviz -->
  <include
    file="$(find pr2_interactive_manipulation_frontend)/launch/pr2_interactive_manipulation_desktop.launch">
    <arg
      name="rviz_config_file_base"
      value="$(find figleaf_2d)/config/$(arg filter).rviz" />
  </include>
</launch>
